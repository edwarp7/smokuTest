<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>SMOKU</title>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=kzfwh7kw4c"></script>
    <style>
        #map {
            position: relative;
        }
        .infoWindow {
            display: none;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50vw;
            max-width: 300px;
            height: 100vw;
            max-height: 600px;
            background-color: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
        }
        .infoWindow img {
            max-width: 100%;
            height: auto;
            max-height: 70%;
            /* border-radius: 10px; */
        }
        .startLoadBtn {
            margin-top: 10px;
            cursor: pointer;
            padding: 5px 10px;
            background-color: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 4px;
        }
        .closeBtn {
            margin-top: 10px;
            cursor: pointer;
            padding: 5px 10px;
            background-color: gray;
            color: #fff;
            border: none;
            border-radius: 4px;
        }      
    </style>
</head>
<body>
    <div id="map" style="width:100%; height:800px;">
        <div class="infoWindow" id="window1">
            <p class="info" id="info1">기숙사</p>
            <img src="/image_p/p1.png">
            <button class="startLoadBtn" id="start1">안내 시작</button>
            <button class="closeBtn" id="close1">창닫기</button>
        </div>
        <div class="infoWindow" id="window2">
            <p class="info" id="info2">기술혁신관</p>
            <img src="/image_p/p2.png">
            <button class="startLoadBtn" id="start2">안내 시작</button>
            <button class="closeBtn" id="close2">창닫기</button>
        </div>
        <div class="infoWindow" id="window3">
            <p class="info" id="info3">산학협동관</p>
            <img src="/image_p/p3.png">
            <button class="startLoadBtn" id="start3">안내 시작</button>
            <button class="closeBtn" id="close3">창닫기</button>
        </div>
        <div class="infoWindow" id="window4">
            <p class="info" id="info4">도서관</p>
            <img src="image_p/p4.png">
            <button class="startLoadBtn" id="start4">안내 시작</button>
            <button class="closeBtn" id="close4">창닫기</button>
        </div>
        <div class="infoWindow" id="window5">
            <p class="info" id="info5">예디대1</p>
            <img src="image_p/p5.png">
            <button class="startLoadBtn" id="start5">안내 시작</button>
            <button class="closeBtn" id="close5">창닫기</button>
        </div>
        <div class="infoWindow" id="window6">
            <p class="info" id="info6">문과대</p>
            <img src="image_p/p6.jpg">
            <button class="startLoadBtn" id="start6">안내 시작</button>
            <button class="closeBtn" id="close6">창닫기</button>
        </div>
        <div class="infoWindow" id="window7">
            <p class="info" id="info7">이과대</p>
            <img src="image_p/p7.png">
            <button class="startLoadBtn" id="start7">안내 시작</button>
            <button class="closeBtn" id="close7">창닫기</button>
        </div>
        <div class="infoWindow" id="window8">
            <p class="info" id="info8">황소상</p>
            <img src="image_p/p8.jpg">
            <button class="startLoadBtn" id="start8">안내 시작</button>
            <button class="closeBtn" id="close8">창닫기</button>
        </div>
        <div class="infoWindow" id="window9">
            <p class="info" id="info9">공학관</p>
            <img src="image_p/p9.png">
            <button class="startLoadBtn" id="start9">안내 시작</button>
            <button class="closeBtn" id="close9">창닫기</button>
        </div>
        <div class="infoWindow" id="window10">
            <p class="info" id="info10">신공학관</p>
            <img src="image_p/p10.png">
            <button class="startLoadBtn" id="start10">안내 시작</button>
            <button class="closeBtn" id="close10">창닫기</button>
        </div>
        <div class="infoWindow" id="window11">
            <p class="info" id="info11">행정관</p>
            <img src="image_p/p11.jpg">
            <button class="startLoadBtn" id="start11">안내 시작</button>
            <button class="closeBtn" id="close11">창닫기</button>
        </div>
        <div class="infoWindow" id="window12">
            <p class="info" id="info12">상허관</p>
            <img src="image_p/p12.jpg">
            <button class="startLoadBtn" id="start12">안내 시작</button>
            <button class="closeBtn" id="close12">창닫기</button>
        </div>
        <div class="infoWindow" id="window13">
            <p class="info" id="info13">법학관</p>
            <img src="image_p/p13.jpg">
            <button class="startLoadBtn" id="start13">안내 시작</button>
            <button class="closeBtn" id="close13">창닫기</button>
        </div>
        <div class="infoWindow" id="window14">
            <p class="info" id="info14">새천년관</p>
            <img src="image_p/p14.jpg">
            <button class="startLoadBtn" id="start14">안내 시작</button>
            <button class="closeBtn" id="close14">창닫기</button>
        </div>
        <div class="infoWindow" id="window15">
            <p class="info" id="info15">체육관</p>
            <img src="image_p/p15.png">
            <button class="startLoadBtn" id="start15">안내 시작</button>
            <button class="closeBtn" id="close15">창닫기</button>
        </div>
    </div>
    <script>
        window.onload = function() {

            // 1. 기숙사 프론티어      (37.539314, 127.078426)
            // 2. 기술혁신관 주차장     (37.539734, 127.077744)
            // 3. 산협협동관 주차장     (37.539324, 127.073454)
            // 4. 도서관             (37.542006, 127.074458)
            // 5. 예디대1             (37.542586, 127.072790)
            // 6. 문과대 뒤           (37.543091, 127.078600)
            // 7. 이과대 옆           (37.541781, 127.080444)
            // 8. 황소상 옆           (37.542749, 127.076197)
            // 9. 공학관             (37.541490, 127.078981)
            // 10. 신공학관           (37.540503, 127.079287)
            // 11. 행정관 뒤          (37.543604, 127.074972)
            // 12. 상허관             (37.543822, 127.075768)
            // 13. 법학관            (37.541563, 127.075599)
            // 14. 새천년관           (37.543295, 127.077583)
            // 15. 체육관             (37.544699, 127.079416)

            // 흡연장 좌표 위도,경도 배열 (황소상까지만)
            var arrLa = [37.539314, 37.539734, 37.539324, 37.542006, 37.542586, 37.543091, 37.541781, 37.542749, 37.541490, 37.540503, 37.543604, 37.543822, 37.541563, 37.543295, 37.544699];
            var arrLo = [127.078426,127.077744,127.073454,127.074458,127.072790,127.078600,127.080444,127.076197,127.078981,127.079287,127.074972,127.075768,127.075599,127.077583,127.079416];

            // 지도
            var myMap;
            // 경로
            var polyline;
            // 위치 추적
            var watchID;

            var myMarker;
            // 흡연장 정보창
            var window1 = document.getElementById("window1");
            var window2 = document.getElementById("window2");
            var window3 = document.getElementById("window3");
            var window4 = document.getElementById("window4");
            var window5 = document.getElementById("window5");
            var window6 = document.getElementById("window6");
            var window7 = document.getElementById("window7");
            var window8 = document.getElementById("window8");
            var window9 = document.getElementById("window9");
            var window10 = document.getElementById("window10");
            var window11 = document.getElementById("window11");
            var window12 = document.getElementById("window12");
            var window13 = document.getElementById("window13");
            var window14 = document.getElementById("window14");
            var window15 = document.getElementById("window15");
            // 경로 시작 버튼
            var start1 = document.getElementById("start1");
            var start2 = document.getElementById("start2");
            var start3 = document.getElementById("start3");
            var start4 = document.getElementById("start4");
            var start5 = document.getElementById("start5");
            var start6 = document.getElementById("start6");
            var start7 = document.getElementById("start7");
            var start8 = document.getElementById("start8");
            var start9 = document.getElementById("start9");
            var start10 = document.getElementById("start10");
            var start11 = document.getElementById("start11");
            var start12 = document.getElementById("start12");
            var start13 = document.getElementById("start13");
            var start14 = document.getElementById("start14");
            var start15 = document.getElementById("start15");
            // 창닫기 버튼
            var close1 = document.getElementById("close1");
            var close2 = document.getElementById("close2");
            var close3 = document.getElementById("close3");
            var close4 = document.getElementById("close4");
            var close5 = document.getElementById("close5");
            var close6 = document.getElementById("close6");
            var close7 = document.getElementById("close7");
            var close8 = document.getElementById("close8");
            var close9 = document.getElementById("close9");
            var close10 = document.getElementById("close10");
            var close11 = document.getElementById("close11");
            var close12 = document.getElementById("close12");
            var close13 = document.getElementById("close13");
            var close14 = document.getElementById("close14");
            var close15 = document.getElementById("close15");

            // 창닫기
            function closeWindow() {
                window1.style.display = "none";
                window2.style.display = "none";
                window3.style.display = "none";
                window4.style.display = "none";
                window5.style.display = "none";
                window6.style.display = "none";
                window7.style.display = "none";
                window8.style.display = "none";
                window9.style.display = "none";
                window10.style.display = "none";
                window11.style.display = "none";
                window12.style.display = "none";
                window13.style.display = "none";
                window14.style.display = "none";
                window15.style.display = "none";
            }

            // 시작하면 한번 현재 위치 불러와서 지도 생성
            navigator.geolocation.getCurrentPosition(function(pos) {
                var latitude = pos.coords.latitude;     // 현재 위도                
                var longitude = pos.coords.longitude;   // 현재 경도
                loadMap(latitude, longitude);
            });
            
            // 위치 업데이트 함수
            function updateLocation(pos) {
                var latitude = pos.coords.latitude;
                var longitude = pos.coords.longitude;
                //myMap.setCenter(new naver.maps.LatLng(latitude, longitude));    // 지도 내 위치로 고정

                if(myMarker){
                    myMarker.setMap(null);
                }

                myMarker = new naver.maps.Marker({
                    position: new naver.maps.LatLng(latitude, longitude),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Bullseye.png"
                    },
                });
                //console.log(latitude + " | " + longitude);
            }

            // 지도 생성 함수, 실시간 위치 추적
            function loadMap(latitude, longitude) {

                let markers = new Array();

                // 네이버 지도 객체
                myMap = new naver.maps.Map('map', {
                    center: new naver.maps.LatLng(latitude, longitude), // 현재 위치로 중심 좌표 설정
                    zoom: 16, // 확대 레벨 설정
                });

                // 현재 위치 마커
                myMarker = new naver.maps.Marker({
                    position: new naver.maps.LatLng(latitude, longitude),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Bullseye.png"
                    },
                });

                // 1. 기숙사 마커
                var marker1 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[0], arrLo[0]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 기숙사 마커 클릭
                naver.maps.Event.addListener(marker1, "click", function() {
                    window1.style.display = "flex";
                });
                // 기숙사 마커 추가
                markers.push(marker1);
                // 경로 생성
                start1.addEventListener("click", function() {
                    // var latitude1 = position.coords.latitude;     // 현재 위도                
                    // var longitude1 = position.coords.longitude;   // 현재 경도
                    // console.log(latitude1 + " | " + longitude1 + "in giksa");
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude1 = pos.coords.latitude;     // 현재 위도                
                        var longitude1 = pos.coords.longitude;   // 현재 경도
                        console.log(latitude1 + " | " + longitude1 + "in giksa");
                        loadDirection(latitude1, longitude1, arrLa[0], arrLo[0]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker1.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                    // loadDirection(latitude, longitude, arrLa[0], arrLo[0]);
                    //     for (var i=0 ; i<markers.length ; i++) {
                    //         markers[i].setIcon({
                    //             url : "/image_ui/icon_Joint_2.png"
                    //         });
                    //     }
                    //     marker1.setIcon({
                    //         url : "/image_ui/icon_Joint_1.png"
                    //     });
                    //     closeWindow();
                });
                // 정보창 없이기
                close1.addEventListener("click", function() {
                    closeWindow();
                });

                // 2. 기술혁신관 주차장 마커
                var marker2 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[1], arrLo[1]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 기술혁신관 마커 클릭
                naver.maps.Event.addListener(marker2, "click", function() {
                    window2.style.display = "flex";
                });
                // 기술혁신관 마커 추가
                markers.push(marker2);
                // 경로 생성
                start2.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude2 = pos.coords.latitude;     // 현재 위도                
                        var longitude2 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude2, longitude2, arrLa[1], arrLo[1]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker2.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                    
                });
                // 정보창 없이기
                close2.addEventListener("click", function() {
                    closeWindow();
                });

                // 3. 산학협동관 주차장 마커
                var marker3 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[2], arrLo[2]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 산협 마커 클릭
                naver.maps.Event.addListener(marker3, "click", function() {
                    window3.style.display = "flex";
                });
                // 산협 마커 추가
                markers.push(marker3);
                // 경로 생성
                start3.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[2], arrLo[2]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker3.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close3.addEventListener("click", function() {
                    closeWindow();
                });

                // 4. 도서관 마커
                var marker4 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[3], arrLo[3]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 도서관 마커 클릭
                naver.maps.Event.addListener(marker4, "click", function() {
                    window4.style.display = "flex";
                });
                // 도서관 마커 추가
                markers.push(marker4);
                // 경로 생성
                start4.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[3], arrLo[3]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker4.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close4.addEventListener("click", function() {
                    closeWindow();
                });

                // 5. 예디대 마커
                var marker5 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[4], arrLo[4]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 예디대 마커 클릭
                naver.maps.Event.addListener(marker5, "click", function() {
                    window5.style.display = "flex";
                });
                // 예디대 마커 추가
                markers.push(marker5);
                // 경로 생성
                start5.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[4], arrLo[4]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker5.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close5.addEventListener("click", function() {
                    closeWindow();
                });

                // 6. 문과대 뒤 마커
                var marker6 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[5], arrLo[5]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 문과대 마커 클릭
                naver.maps.Event.addListener(marker6, "click", function() {
                    window6.style.display = "flex";
                });
                // 문과대 마커 추가
                markers.push(marker6);
                // 경로 생성
                start6.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[5], arrLo[5]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker6.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close6.addEventListener("click", function() {
                    closeWindow();
                });

                // 7. 이과관 옆 마커
                var marker7 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[6], arrLo[6]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 이과대 마커 클릭
                naver.maps.Event.addListener(marker7, "click", function() {
                    window7.style.display = "flex";
                });
                // 이과대 마커 추가
                markers.push(marker7);
                // 경로 생성
                start7.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[6], arrLo[6]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker7.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close7.addEventListener("click", function() {
                    closeWindow();
                });

                // 8. 새천년관 학생회관 황소상 마커
                var marker8 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[7], arrLo[7]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 황소상 마커 클릭
                naver.maps.Event.addListener(marker8, "click", function() {
                    window8.style.display = "flex";
                });
                // 황소상 마커 추가
                markers.push(marker8);
                // 경로 생성
                start8.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[7], arrLo[7]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker8.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close8.addEventListener("click", function() {
                    closeWindow();
                });

                // 9. 공학관 마커
                var marker9 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[8], arrLo[8]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 공학관 마커 클릭
                naver.maps.Event.addListener(marker9, "click", function() {
                    window9.style.display = "flex";
                });
                // 공학관 마커 추가
                markers.push(marker9);
                // 경로 생성
                start9.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[8], arrLo[8]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker9.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close9.addEventListener("click", function() {
                    closeWindow();
                });

                // 10. 신공학관 마커
                var marker10 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[9], arrLo[9]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 신공학관 마커 클릭
                naver.maps.Event.addListener(marker10, "click", function() {
                    window10.style.display = "flex";
                });
                // 신공학관 마커 추가
                markers.push(marker10);
                // 경로 생성
                start10.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[9], arrLo[9]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker10.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close10.addEventListener("click", function() {
                    closeWindow();
                });

                // 11. 행정관 마커
                var marker11 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[10], arrLo[10]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 행정관 마커 클릭
                naver.maps.Event.addListener(marker11, "click", function() {
                    window11.style.display = "flex";
                });
                // 행정관 마커 추가
                markers.push(marker11);
                // 경로 생성
                start11.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[10], arrLo[10]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker11.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close11.addEventListener("click", function() {
                    closeWindow();
                });

                // 12. 상허관 마커
                var marker12 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[11], arrLo[11]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 상허관 마커 클릭
                naver.maps.Event.addListener(marker12, "click", function() {
                    window12.style.display = "flex";
                });
                // 상허관 마커 추가
                markers.push(marker12);
                // 경로 생성
                start12.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[11], arrLo[11]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker12.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close12.addEventListener("click", function() {
                    closeWindow();
                });

                // 13. 법학관 마커
                var marker13 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[12], arrLo[12]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 법학관 마커 클릭
                naver.maps.Event.addListener(marker13, "click", function() {
                    window13.style.display = "flex";
                });
                // 법학관 마커 추가
                markers.push(marker13);
                // 경로 생성
                start13.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[12], arrLo[12]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker13.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close13.addEventListener("click", function() {
                    closeWindow();
                });

                // 14. 새천년관 마커
                var marker14 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[13], arrLo[13]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 새천년관 마커 클릭
                naver.maps.Event.addListener(marker14, "click", function() {
                    window14.style.display = "flex";
                });
                // 새천년관 마커 추가
                markers.push(marker14);
                // 경로 생성
                start14.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[13], arrLo[13]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker14.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close14.addEventListener("click", function() {
                    closeWindow();
                });

                // 15. 체육관 마커
                var marker15 = new naver.maps.Marker({
                    position: new naver.maps.LatLng(arrLa[14], arrLo[14]),
                    map: myMap,
                    icon: {
                        url : "/image_ui/icon_Joint_2.png"
                    },
                });
                // 상허관 마커 클릭
                naver.maps.Event.addListener(marker15, "click", function() {
                    window15.style.display = "flex";
                });
                // 상허관 마커 추가
                markers.push(marker15);
                // 경로 생성
                start15.addEventListener("click", function() {
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var latitude3 = pos.coords.latitude;     // 현재 위도                
                        var longitude3 = pos.coords.longitude;   // 현재 경도
                        loadDirection(latitude3, longitude3, arrLa[14], arrLo[14]);
                        for (var i=0 ; i<markers.length ; i++) {
                            markers[i].setIcon({
                                url : "/image_ui/icon_Joint_2.png"
                            });
                        }
                        marker15.setIcon({
                            url : "/image_ui/icon_Joint_1.png"
                        });
                        closeWindow();
                    });
                });
                close15.addEventListener("click", function() {
                    closeWindow();
                });

                // 실시간 위치 업데이트
                watchID = navigator.geolocation.watchPosition(updateLocation);
                
            }

            // 경로 생성 함수
            function loadDirection(fromLa, fromLo, toLa, toLo) {

                // 요청 URL
                var url = 
                    "/naver-maps-api/map-direction/v1/driving?start="+
                    fromLo+","+fromLa+"&goal="+toLo+","+toLa+"&option=trafast";

                // 요청 헤더
                var headers = new Headers();
                headers.set("X-NCP-APIGW-API-KEY-ID", "kzfwh7kw4c");
                headers.set("X-NCP-APIGW-API-KEY", "7kG78fhb682p372iIlm7I4L73aPaTYQVlPlqNzXf");

                // HTTP 요청 설정
                var requestOptions = {
                    method: 'GET',
                    headers: headers,
                    redirect: 'follow'
                };

                // HTTP 요청 보내기
                fetch(url, requestOptions)
                    .then(response => {
                        // response.ok가 아닌 response.status를 사용
                        if (response.status !== 200) {
                            throw new Error('API 오류: ' + response.status);
                        }
                        return response.json();
                    })
                    .then(result => {
                        // API 응답(result)을 여기서 처리
                        console.log(result);

                        // 경로 좌표를 가져오기
                        var pathArray = result.route.trafast[0].path;

                        // pathArray를 사용하여 경로 좌표 배열 생성
                        var pathCoordinates = [];
                        for (var i = 0; i < pathArray.length; i++) {
                            var lat = parseFloat(pathArray[i][1]); // 위도
                            var lng = parseFloat(pathArray[i][0]); // 경도
                            pathCoordinates.push(new naver.maps.LatLng(lat, lng));
                        }

                        // 이전 경로 지우기
                        if (polyline) {
                            polyline.setMap(null);
                        }

                        // 경로 Polyline을 지도에 추가
                        polyline = new naver.maps.Polyline({
                            path: pathCoordinates,
                            map: myMap,
                            strokeColor: '#4CAF50',
                            strokeWeight: 7,
                        });
                        
                        // 도착 확인
                        // if (checkArrival(toLa, toLo, fromLa, fromLo)) {
                        //     alert("도착!");
                        // }

                        var isarrive = navigator.geolocation.watchPosition(
                            function(){
                                if(checkArrival(toLa, toLo, fromLa, fromLo)){
                                    alert("도착했습니다.");
                                    navigator.geolocation.clearWatch(isarrive);
                                    if (polyline) {
                                        polyline.setMap(null);
                                    }
                                }
                            }
                        );

                    })
                    .catch(error => {
                        // 오류 처리
                        console.error('API 요청 중 오류 발생:', error);
                    });
            };

            

            // Haversine 공식을 사용하여 두 지점 간의 거리를 계산
            function calculateDistance(lat1, lon1, lat2, lon2) {
                var R = 6371; // 지구 반지름 (단위: 킬로미터)
                var dLat = deg2rad(lat2 - lat1);
                var dLon = deg2rad(lon2 - lon1);
                var a =
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                var distance = R * c;
                return distance;
            }
            function deg2rad(deg) {
                return deg * (Math.PI / 180);
            }

            // 도착 확인 함수
            function checkArrival(fromLa, fromLo, toLa, toLo) {
                var distance = calculateDistance(fromLa, fromLo, toLa, toLo);
                //alert("거리 : "+distance);
                if(distance < 0.01){
                    alert("도착?");
                    return true;
                }else{
                    alert("도착안함");
                    return false;
                }
                //return distance < 0.01; // 거리가 10미터 이내로 접근하면 도착으로 간주
            };

            // 페이지를 닫을 때 위치 추적 중지
            window.onbeforeunload = function() {
                navigator.geolocation.clearWatch(watchID);
            };
        };
    </script>
</body>
</html>